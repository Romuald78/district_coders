{% extends "district/common/base.html" %}

{% block page_header %}
  {% with page_title="Change password" %}
    {{ block.super }}
  {% endwith %}
{% endblock %}

{% block page_content %}
<div class="flex items-center justify-center min-h-screen font-mono text-red-400">
  <div id="rain-container" class="absolute inset-0 -z-10 pointer-events-none"></div>

  <div class="relative w-full max-w-3xl bg-zinc-900 border-2 border-indigo-600 shadow-[0_0_15px_rgba(129,140,248,0.5)] rounded-3xl p-10 m-6 space-y-6">

    <h2 class="text-3xl font-extrabold text-indigo-400 uppercase tracking-widest drop-shadow-[0_0_6px_rgba(129,140,248,0.8)]">
      Change your password
    </h2>
    <p class="text-sm text-indigo-300 drop-shadow-[0_0_3px_rgba(129,140,248,0.5)]">
      Choose a strong password you haven't used before.
    </p>

    <form method="POST" class="space-y-6">
      {% csrf_token %}

      {% for field in form %}
      <div class="mb-4">
  <label for="{{ field.id_for_label }}"
         class="block mb-1 text-sm font-semibold uppercase text-indigo-400 tracking-wide drop-shadow-[0_0_4px_rgba(129,140,248,0.6)]">
    {{ field.label }}
  </label>

  <div class="relative">
    <input type="{{ field.field.widget.input_type }}"
           name="{{ field.html_name }}"
           id="{{ field.id_for_label }}"
           class="w-full px-3 py-2 pr-10 text-sm bg-zinc-800 text-indigo-300 placeholder-indigo-500 outline-none rounded-md border border-indigo-600 shadow-inner focus:ring-2 focus:ring-indigo-400"
           {% if field.value %}value="{{ field.value }}"{% endif %}>

    {% if field.field.widget.input_type == "password" %}
    <button type="button"
            onclick="togglePassword('{{ field.id_for_label }}', 'icon-{{ field.id_for_label }}')"
            class="absolute right-3 top-1/2 -translate-y-1/2 text-amber-400 hover:text-amber-200 transition w-6 h-6 flex items-center justify-center drop-shadow-[0_0_5px_rgba(251,191,36,0.7)]">
      <i id="icon-{{ field.id_for_label }}" class="fa-solid fa-eye text-[1.25rem]"></i>
    </button>
    {% endif %}
  </div>

  {% if field.errors %}
  <p class="text-sm text-red-500 mt-1 drop-shadow-[0_0_2px_rgba(255,0,0,0.8)]">
    {{ field.errors }}
  </p>
  {% endif %}
</div>

      {% endfor %}

      {% if form.non_field_errors %}
        <div class="text-red-500 text-sm mb-4 drop-shadow-[0_0_2px_rgba(255,0,0,0.8)]">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <button type="submit"
              class="w-full py-2 mt-4 bg-indigo-700 text-white font-extrabold rounded-md hover:bg-indigo-600 transition shadow-[0_0_12px_rgba(129,140,248,0.6)]">
        Update Password
      </button>
    </form>
  </div>
</div>

<script>
  function togglePassword(inputId, iconId) {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(iconId);
    if (input && icon) {
      if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
      } else {
        input.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
      }
    }
  }
</script>
{% endblock %}
