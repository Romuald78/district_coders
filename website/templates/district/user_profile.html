{% extends "district/common/base.html" %}
{% load static %}

{% block page_header %}
    {% with page_title="Digital Profile" %}
        {{ block.super }}
    {% endwith %}
{% endblock %}

{% block page_content %}
<div class="relative min-h-screen font-mono text-indigo-400 flex flex-col items-center p-10 overflow-hidden">

  <div id="rain-container" class="absolute inset-0 -z-10 pointer-events-none"></div>

  <!-- Main title -->
  <h1 class="text-5xl mb-12 tracking-widest text-cyan-400 text-center animate-pulse drop-shadow-[0_0_15px_cyan]"
      style="font-family: 'Orbitron', sans-serif;">
    [ DIGITAL IDENTITY CARD ]
  </h1>

  <!-- Profile card -->
  <section
  class="relative w-full max-w-6xl bg-zinc-900 border border-cyan-500 rounded-3xl p-10 shadow-[0_0_20px_cyan] flex flex-col md:flex-row gap-10 transition-transform duration-500 hover:scale-[1.04] hover:shadow-[0_0_25px_cyan]">

     <!-- Floating button at top left of map -->
  <a href="{% url 'update' user.id %}"
     class="absolute top-4 left-4 bg-black border border-indigo-400 text-indigo-400 px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-semibold
            hover:bg-indigo-400 hover:text-black transition shadow-[0_0_15px_indigo] hover:shadow-[0_0_25px_indigo] z-20"
     aria-label="Edit Profile">
    <i class="fas fa-edit"></i>
    Edit
  </a>

    <!-- Profile picture -->
    <div class="flex flex-col items-center justify-center shrink-0">
      <a href="{% url 'update' user.id %}" aria-label="Edit Profile Picture">
        {% if user.icon %}
          <img src="{{ MEDIA_URL }}{{ user.icon }}" alt="Profile Icon"
            class="w-44 h-44 rounded-full object-cover object-center"/>
        {% else %}
          <img src="{% static 'images/logos/avatar.png' %}" alt="Default Profile Icon"
            class="w-44 h-44 rounded-full object-cover object-center"/>
        {% endif %}
      </a>
    </div>


    <!-- User information -->
    <div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-x-10 gap-y-6 text-lg text-cyan-300">

      <div class="font-extrabold uppercase tracking-widest border-b border-cyan-600 pb-1">ID</div>
      <div class="border-b border-cyan-600 pb-1">[{{ user.id }}]</div>

      <div class="font-extrabold uppercase tracking-widest border-b border-cyan-600 pb-1">Name</div>
      <div class="border-b border-cyan-600 pb-1">{{ user.first_name }} {{ user.last_name }}</div>

      <div class="font-extrabold uppercase tracking-widest border-b border-cyan-600 pb-1">Username</div>
      <div class="border-b border-cyan-600 pb-1">'{{ user.username }}'</div>

      <div class="font-extrabold uppercase tracking-widest border-b border-cyan-600 pb-1">Email</div>
      <div class="border-b border-cyan-600 pb-1 flex items-center gap-2">
        {{ user.email }}
        <a href="/accounts/email_change_auth/"
           class="ml-auto text-indigo-400 hover:text-cyan-300 transition"><i class="fa-solid fa-user-pen"></i></a>
      </div>

      <div class="font-extrabold uppercase tracking-widest border-b border-cyan-600 pb-1">Password</div>
      <div class="border-b border-cyan-600 pb-1 flex items-center gap-2">
        ********
        <a href="/accounts/password_change/"
           class="ml-auto text-indigo-400 hover:text-cyan-300 transition"><i class="fa-solid fa-user-pen"></i></a>
      </div>

        <div class="font-extrabold uppercase tracking-widest border-b border-cyan-600 pb-1">
          Description
        </div>
        <div class="border-b border-cyan-600 pb-1 break-words max-w-full">
          {{ user.description }}
        </div>

        <div class="font-extrabold uppercase tracking-widest border-b border-cyan-600 pb-1">
          Groups Assigned
        </div>
        <div class="border-b border-cyan-600 pb-1 break-words max-w-full">
          <ul id="groups">
            <!-- JS injected groups here -->
          </ul>
        </div>
    </div>
  </section>





  <!-- Registration key form -->
  <section
    class="mt-14 w-full max-w-md bg-black border border-emerald-500 rounded-2xl px-8 py-4 shadow-lg
           transition hover:shadow-[0_0_25px_#10b981,0_0_35px_#10b981]">

    <form id="register_form" method="post" class="flex flex-col" novalidate>
      {% csrf_token %}
      <label for="register_key" class="mb-3 text-emerald-400 uppercase tracking-wider text-sm">Registration Key</label>
      <input type="text" id="register_key" name="register_key"
             class="px-5 py-3 bg-black border border-emerald-500 text-emerald-300 placeholder-emerald-700 rounded-lg mb-6
                    focus:outline-none focus:ring-2 focus:ring-emerald-400 transition"
             placeholder="Enter your registration keyâ€¦">
      <input type="button" onclick="send_register_key();" value="Send"
             class="cursor-pointer bg-emerald-400 text-black font-bold py-3 rounded-lg hover:bg-emerald-500 transition
                    hover:scale-[1.05] shadow-[0_0_15px_emerald]">
    </form>

<div id="register_result" class="mt-5 text-center tracking-wide text-sm min-h-[1.5rem]"></div>
  </section>

  <script>display_user_groups();</script>
</div>
{% endblock %}
